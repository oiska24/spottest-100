(()=>{"use strict";var __webpack_exports__={};(()=>{var exports=__webpack_exports__,__webpack_unused_export__;__webpack_unused_export__={value:!0};const clientId="8810b93c97364706a68dba1d23e0f640",redirectUrl="http://localhost:8080",authorizationEndpoint="https://accounts.spotify.com/authorize",tokenEndpoint="https://accounts.spotify.com/api/token",scope="user-read-private user-read-email",currentToken={get access_token(){return localStorage.getItem("access_token")},get refresh_token(){return localStorage.getItem("refresh_token")},get expires_in(){return localStorage.getItem("refresh_in")},get expires(){return localStorage.getItem("expires")},save:function(e){const{access_token:t,refresh_token:r,expires_in:n}=e;localStorage.setItem("access_token",t),localStorage.setItem("refresh_token",r),localStorage.setItem("expires_in",n.toString());const o=new Date,a=new Date(o.getTime()+1e3*n);localStorage.setItem("expires",a.toISOString())}},args=new URLSearchParams(window.location.search),code=args.get("code");if(code){(async()=>{const e=await getToken(code);currentToken.save(e)})();const e=new URL(window.location.href);e.searchParams.delete("code");const t=e.search?e.href:e.href.replace("?","");window.history.replaceState({},document.title,t)}async function redirectToSpotifyAuthorize(){const e=crypto.getRandomValues(new Uint8Array(64)).reduce(((e,t)=>e+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789"[t%62]),""),t=(new TextEncoder).encode(e),r=await crypto.subtle.digest("SHA-256",t),n=btoa(String.fromCharCode(...new Uint8Array(r))).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_");window.localStorage.setItem("code_verifier",e);const o=new URL(authorizationEndpoint),a={response_type:"code",client_id:clientId,scope,code_challenge_method:"S256",code_challenge:n,redirect_uri:redirectUrl};o.search=new URLSearchParams(a).toString(),window.location.href=o.toString()}async function getToken(e){const t=localStorage.getItem("code_verifier"),r=await fetch(tokenEndpoint,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({client_id:clientId,grant_type:"authorization_code",code:e,redirect_uri:redirectUrl,code_verifier:t})});return await r.json()}async function refreshToken(){const e=await fetch(tokenEndpoint,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({client_id:clientId,grant_type:"refresh_token",refresh_token:currentToken.refresh_token})});return await e.json()}async function getUserData(){const e=await fetch("https://api.spotify.com/v1/me",{method:"GET",headers:{Authorization:"Bearer "+currentToken.access_token}});return await e.json()}async function getUserPlaylists(){const e=await fetch("https://api.spotify.com/v1/playlists",{method:"GET",headers:{Authorization:"Bearer "+currentToken.access_token}});return await e.json()}async function loginWithSpotifyClick(){await redirectToSpotifyAuthorize()}async function logoutClick(){localStorage.clear(),window.location.href=redirectUrl}async function refreshTokenClick(){const e=await refreshToken();currentToken.save(e),renderTemplate("oauth","oauth-template",currentToken)}function renderTemplate(targetId,templateId,data=null){const template=document.getElementById(templateId),clone=template.content.cloneNode(!0),elements=clone.querySelectorAll("*");elements.forEach((ele=>{const bindingAttrs=[...ele.attributes].filter((e=>e.name.startsWith("data-bind")));bindingAttrs.forEach((attr=>{const target=attr.name.replace(/data-bind-/,"").replace(/data-bind/,""),targetType=target.startsWith("onclick")?"HANDLER":"PROPERTY",targetProp=""===target?"innerHTML":target,prefix="PROPERTY"===targetType?"data.":"",expression=prefix+attr.value.replace(/;\n\r\n/g,"");try{ele[targetProp]="PROPERTY"===targetType?eval(expression):()=>{eval(expression)},ele.removeAttribute(attr.name)}catch(e){console.error(`Error binding ${expression} to ${targetProp}`,e)}}))}));const target=document.getElementById(targetId);target&&(target.innerHTML="",target.appendChild(clone))}currentToken.access_token&&(async()=>{renderTemplate("main","logged-in-template",await getUserPlaylists()),renderTemplate("oauth","oauth-template",currentToken)})(),currentToken.access_token||renderTemplate("main","login")})()})();